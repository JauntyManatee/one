angular.module("pageslide-directive",[]).directive("pageslide",["$document",function(n){return{restrict:"EAC",transclude:!1,scope:{psOpen:"=?",psAutoClose:"=?",psSide:"@",psSpeed:"@",psClass:"@",psSize:"@",psSqueeze:"@",psCloak:"@",psPush:"@",psContainer:"@",psKeyListener:"@",psBodyClass:"@"},link:function(t,e,r){function u(n){if(f.bodyClass){var t=f.className+"-body",e=RegExp(" "+t+"-closed| "+t+"-open");p.className=p.className.replace(e,""),p.className+=" "+t+"-"+n}}function i(n){p.style.top=n.top||p.style.top,p.style.right=n.right||p.style.right,p.style.bottom=n.bottom||p.style.bottom,p.style.left=n.left||p.style.left}function o(n){g.style.top=n.top||g.style.top,g.style.right=n.right||g.style.right,g.style.bottom=n.bottom||g.style.bottom,g.style.left=n.left||g.style.left}function a(n){g.style.width=n.width||g.style.width,g.style.height=n.height||g.style.height}function s(e,r){if(e&&0!==e.style.width)switch(r.cloak&&h.css("display","none"),r.side){case"right":a({width:"0px"}),r.squeeze&&o({right:"0px"}),r.push&&o({right:"0px",left:"0px"});break;case"left":a({width:"0px"}),r.squeeze&&o({left:"0px"}),r.push&&o({right:"0px",left:"0px"});break;case"top":a({height:"0px"}),r.squeeze&&o({top:"0px"}),r.push&&o({top:"0px",bottom:"0px"});break;case"bottom":a({height:"0px"}),r.squeeze&&o({bottom:"0px"}),r.push&&o({top:"0px",bottom:"0px"})}t.psOpen=!1,r.keyListener&&n.off("keydown",c),u("closed")}function l(t,e){if(0!==t.style.width){switch(e.side){case"right":a({width:e.size}),e.squeeze&&i({right:e.size}),e.push&&i({right:e.size,left:"-"+e.size});break;case"left":a({width:e.size}),e.squeeze&&i({left:e.size}),e.push&&i({right:"-"+e.size,left:e.size});break;case"top":a({height:e.size}),e.squeeze&&i({top:e.size}),e.push&&i({top:e.size,bottom:"-"+e.size});break;case"bottom":a({height:e.size}),e.squeeze&&i({bottom:e.size}),e.push&&i({top:"-"+e.size,bottom:e.size})}setTimeout(function(){e.cloak&&h.css("display","block")},1e3*e.speed),e.keyListener&&n.on("keydown",c),u("open")}}function c(n){var t=27,e=n.keyCode||n.which;e===t&&s(g,f)}var f={bodyClass:t.psBodyClass||!1,className:t.psClass||"ng-pageslide",cloak:t.psCloak&&"false"==t.psCloak.toLowerCase()?!1:!0,container:t.psContainer||!1,keyListener:!!t.psKeyListener||!1,push:!!t.psPush||!1,side:t.psSide||"right",size:t.psSize||"300px",speed:t.psSpeed||"0.5",squeeze:!!t.psSqueeze||!1,zIndex:-1};e.addClass(f.className);var h=null,g=null,p=f.container&&document.getElementById(f.container)||document.body;if(u("closed"),g=e[0],"div"!==g.tagName.toLowerCase()&&"pageslide"!==g.tagName.toLowerCase())throw Error("Pageslide can only be applied to <div> or <pageslide> elements");if(0===g.children.length)throw Error("You have to content inside the <pageslide>");switch(h=angular.element(g.children),p.appendChild(g),g.style["z-index"]=f.zIndex,g.style.position=f.container!==!1?"absolute":"fixed",g.style.width=0,g.style.height=0,g.style.overflow="hidden",g.style["overflow-y"]="scroll",g.style.transitionDuration=f.speed+"s",g.style.webkitTransitionDuration=f.speed+"s",g.style.transitionProperty="width, height",f.squeeze&&(p.style.position="absolute",p.style.transitionDuration=f.speed+"s",p.style.webkitTransitionDuration=f.speed+"s",p.style.transitionProperty="top, bottom, left, right"),f.side){case"right":a({height:r.psCustomHeight||"100%"}),o({top:r.psCustomTop||"0px",right:r.psCustomRight||"0px",bottom:r.psCustomBottom||"0px"});break;case"left":a({height:r.psCustomHeight||"100%"}),o({top:r.psCustomTop||"0px",bottom:r.psCustomBottom||"0px",left:r.psCustomLeft||"0px"});break;case"top":a({width:r.psCustomWidth||"100%"}),o({top:r.psCustomTop||"0px",right:r.psCustomRight||"0px",left:r.psCustomLeft||"0px"});break;case"bottom":a({width:r.psCustomWidth||"100%"}),o({right:r.psCustomRight||"0px",left:r.psCustomLeft||"0px",bottom:r.psCustomBottom||"0px"})}t.$watch("psOpen",function(n){n?l(g,f):s(g,f)}),t.$watch("psSize",function(n,t){t!==n&&(f.size=n,l(g,f))}),t.$on("$destroy",function(){p.removeChild(g)}),t.psAutoClose&&(t.$on("$locationChangeStart",function(){s(g,f)}),t.$on("$stateChangeStart",function(){s(g,f)}))}}}]);