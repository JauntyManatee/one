angular.module("pageslide-directive", [])
    .directive("pageslide", ["$document", function(a) {
        return {
            restrict: "EAC",
            transclude: !1,
            scope: {
                psOpen: "=?",
                psAutoClose: "=?",
                psSide: "@",
                psSpeed: "@",
                psClass: "@",
                psSize: "@",
                psSqueeze: "@",
                psCloak: "@",
                psPush: "@",
                psContainer: "@",
                psKeyListener: "@",
                psBodyClass: "@"
            },
            link: function(b, c, d) {
                function e(a) {
                    if (l.bodyClass) {
                        var b = l.className + "-body",
                            c = new RegExp(" " + b + "-closed| " + b + "-open");
                        o.className = o.className.replace(c, ""), o.className += " " + b + "-" + a
                    }
                }

                function f(a) {
                    o.style.top = a.top || o.style.top, o.style.right = a.right || o.style.right, o.style.bottom = a.bottom || o.style.bottom, o.style.left = a.left || o.style.left
                }

                function g(a) {
                    n.style.top = a.top || n.style.top, n.style.right = a.right || n.style.right, n.style.bottom = a.bottom || n.style.bottom, n.style.left = a.left || n.style.left
                }

                function h(a) {
                    n.style.width = a.width || n.style.width, n.style.height = a.height || n.style.height
                }

                function i(c, d) {
                    if (c && 0 !== c.style.width) switch (d.cloak && m.css("display", "none"), d.side) {
                        case "right":
                            h({
                                width: "0px"
                            }), d.squeeze && g({
                                right: "0px"
                            }), d.push && g({
                                right: "0px",
                                left: "0px"
                            });
                            break;
                        case "left":
                            h({
                                width: "0px"
                            }), d.squeeze && g({
                                left: "0px"
                            }), d.push && g({
                                right: "0px",
                                left: "0px"
                            });
                            break;
                        case "top":
                            h({
                                height: "0px"
                            }), d.squeeze && g({
                                top: "0px"
                            }), d.push && g({
                                top: "0px",
                                bottom: "0px"
                            });
                            break;
                        case "bottom":
                            h({
                                height: "0px"
                            }), d.squeeze && g({
                                bottom: "0px"
                            }), d.push && g({
                                top: "0px",
                                bottom: "0px"
                            })
                    }
                    b.psOpen = !1, d.keyListener && a.off("keydown", k), e("closed")
                }

                function j(b, c) {
                    if (0 !== b.style.width) {
                        switch (c.side) {
                            case "right":
                                h({
                                    width: c.size
                                }), c.squeeze && f({
                                    right: c.size
                                }), c.push && f({
                                    right: c.size,
                                    left: "-" + c.size
                                });
                                break;
                            case "left":
                                h({
                                    width: c.size
                                }), c.squeeze && f({
                                    left: c.size
                                }), c.push && f({
                                    right: "-" + c.size,
                                    left: c.size
                                });
                                break;
                            case "top":
                                h({
                                    height: c.size
                                }), c.squeeze && f({
                                    top: c.size
                                }), c.push && f({
                                    top: c.size,
                                    bottom: "-" + c.size
                                });
                                break;
                            case "bottom":
                                h({
                                    height: c.size
                                }), c.squeeze && f({
                                    bottom: c.size
                                }), c.push && f({
                                    top: "-" + c.size,
                                    bottom: c.size
                                })
                        }
                        setTimeout(function() {
                            c.cloak && m.css("display", "block")
                        }, 1e3 * c.speed), c.keyListener && a.on("keydown", k), e("open")
                    }
                }

                function k(a) {
                    var b = 27,
                        c = a.keyCode || a.which;
                    c === b && i(n, l)
                }
                var l = {
                    bodyClass: b.psBodyClass || !1,
                    className: b.psClass || "ng-pageslide",
                    cloak: b.psCloak && "false" == b.psCloak.toLowerCase() ? !1 : !0,
                    container: b.psContainer || !1,
                    keyListener: Boolean(b.psKeyListener) || !1,
                    push: Boolean(b.psPush) || !1,
                    side: b.psSide || "right",
                    size: b.psSize || "400px",
                    speed: b.psSpeed || "0.5",
                    squeeze: Boolean(b.psSqueeze) || !1,
                    zIndex: 1e3
                };
                c.addClass(l.className);
                var m = null,
                    n = null,
                    o = l.container && document.getElementById(l.container) || document.body;
                if (e("closed"), n = c[0], "div" !== n.tagName.toLowerCase() && "pageslide" !== n.tagName.toLowerCase()) throw new Error("Pageslide can only be applied to <div> or <pageslide> elements");
                if (0 === n.children.length) throw new Error("You have to content inside the <pageslide>");
                switch (m = angular.element(n.children), o.appendChild(n), n.style.zIndex = l.zindex, n.style.position = l.container !== !1 ? "absolute" : "fixed", n.style.width = 0, n.style.height = 0, n.style.overflow = "hidden", n.style.transitionDuration = l.speed + "s", n.style.webkitTransitionDuration = l.speed + "s", n.style.transitionProperty = "width, height", l.squeeze && (o.style.position = "absolute", o.style.transitionDuration = l.speed + "s", o.style.webkitTransitionDuration = l.speed + "s", o.style.transitionProperty = "top, bottom, left, right"), l.side) {
                    case "right":
                        h({
                            height: d.psCustomHeight || "100%"
                        }), g({
                            top: d.psCustomTop || "0px",
                            right: d.psCustomRight || "0px",
                            bottom: d.psCustomBottom || "0px"
                        });
                        break;
                    case "left":
                        h({
                            height: d.psCustomHeight || "100%"
                        }), g({
                            top: d.psCustomTop || "0px",
                            bottom: d.psCustomBottom || "0px",
                            left: d.psCustomLeft || "0px"
                        });
                        break;
                    case "top":
                        h({
                            width: d.psCustomWidth || "100%"
                        }), g({
                            top: d.psCustomTop || "0px",
                            right: d.psCustomRight || "0px",
                            left: d.psCustomLeft || "0px"
                        });
                        break;
                    case "bottom":
                        h({
                            width: d.psCustomWidth || "100%"
                        }), g({
                            right: d.psCustomRight || "0px",
                            left: d.psCustomLeft || "0px",
                            bottom: d.psCustomBottom || "0px"
                        })
                }
                b.$watch("psOpen", function(a) {
                    a ? j(n, l) : i(n, l)
                }), b.$watch("psSize", function(a, b) {
                    b !== a && (l.size = a, j(n, l))
                }), b.$on("$destroy", function() {
                    o.removeChild(n)
                }), b.psAutoClose && (b.$on("$locationChangeStart", function() {
                    i(n, l)
                }), b.$on("$stateChangeStart", function() {
                    i(n, l)
                }))
            }
        }
    }]);
